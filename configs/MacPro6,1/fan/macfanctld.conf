# linux-mac: Mac Pro 6,1 Fan Control Configuration
# For use with macfanctld or custom fan control script
#
# The Mac Pro 6,1 "trash can" has a single centrifugal fan
# that is CRITICAL for cooling — the thermal design relies
# entirely on this fan pulling air through the central core.
#
# Sensors available via applesmc:
#   /sys/devices/platform/applesmc.768/fan1_min
#   /sys/devices/platform/applesmc.768/fan1_max
#   /sys/devices/platform/applesmc.768/fan1_output
#   /sys/devices/platform/applesmc.768/temp*_input
#
# Fan speed range: ~790 RPM (min) to ~1900 RPM (max)
#
# Temperature thresholds (Celsius):
#   CPU idle:     35-45°C
#   CPU load:     55-75°C
#   GPU idle:     40-50°C
#   GPU load:     65-90°C (D700s run hot under compute)
#   Danger zone:  >95°C (thermal throttling imminent)

# --- macfanctld config ---
# If using macfanctld, place this at /etc/macfanctld.conf

# Fan speed floor (RPM) - never go below this
fan_min: 800

# Temperature -> fan speed curve
# Format: temp_sensor fan_speed
# Ramp up aggressively above 70°C for GPU protection
temp_low: 45
temp_high: 80
fan_low: 800
fan_high: 1900

# Poll interval in seconds
poll_interval: 2

# --- Alternative: custom script approach ---
# If macfanctld is unavailable, a simple bash script can manage fans:
#
# #!/bin/bash
# SENSOR="/sys/devices/platform/applesmc.768"
# FAN="${SENSOR}/fan1_min"
#
# while true; do
#     # Read highest temperature from all sensors
#     MAX_TEMP=0
#     for temp in ${SENSOR}/temp*_input; do
#         T=$(cat "$temp" 2>/dev/null)
#         T=$((T / 1000))  # Convert millidegrees to degrees
#         [ "$T" -gt "$MAX_TEMP" ] && MAX_TEMP=$T
#     done
#
#     # Calculate fan speed (linear ramp 45°C-85°C -> 800-1900 RPM)
#     if [ "$MAX_TEMP" -le 45 ]; then
#         SPEED=800
#     elif [ "$MAX_TEMP" -ge 85 ]; then
#         SPEED=1900
#     else
#         SPEED=$(( 800 + (MAX_TEMP - 45) * 1100 / 40 ))
#     fi
#
#     echo "$SPEED" > "$FAN"
#     sleep 2
# done
