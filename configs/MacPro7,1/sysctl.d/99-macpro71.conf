# linux-mac: Mac Pro 7,1 Performance Tuning
# Install to /etc/sysctl.d/99-macpro71.conf
#
# Status: Template â€” values tuned for large-memory, 10GbE configurations.
# Adjust for your actual RAM size and network setup.

# --- Memory (tuned for 192-768GB+ RAM) ---
# With this much RAM, swapping should almost never happen
vm.swappiness = 5
# Aggressively retain filesystem caches
vm.vfs_cache_pressure = 30
# Large RAM means we can handle more dirty pages before flushing
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5
# Allow larger mmap regions (useful for large GPU workloads)
vm.max_map_count = 1048576

# --- Network (tuned for dual 10GbE) ---
# Much larger socket buffers for 10GbE throughput
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.core.rmem_default = 1048576
net.core.wmem_default = 1048576
# TCP buffer auto-tuning for 10GbE
net.ipv4.tcp_rmem = 4096 1048576 67108864
net.ipv4.tcp_wmem = 4096 1048576 67108864
# TCP Fast Open for client + server
net.ipv4.tcp_fastopen = 3
# Handle burst traffic on 10GbE
net.core.netdev_max_backlog = 50000
net.core.netdev_budget = 600
# Google BBR congestion control (requires CONFIG_TCP_CONG_BBR=y)
net.ipv4.tcp_congestion_control = bbr
# Increase connection tracking for server workloads
net.netfilter.nf_conntrack_max = 262144

# --- Kernel ---
# Reduce console log noise
kernel.printk = 3 4 1 3
